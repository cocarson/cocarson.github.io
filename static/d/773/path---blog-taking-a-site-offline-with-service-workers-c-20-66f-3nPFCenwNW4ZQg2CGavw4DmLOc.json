{"data":{"markdownRemark":{"html":"<p><strong>Purpose:</strong> Allow a cached site to be loaded offline.</p>\n<p>Service workers are a technology that have been emphasized by the web community for the past few years, along with terms like \"Progressive Web Apps\" and other futuristic technologies. To be honest, I was always put off by the name. It so jargon-y and technical that I figured it must be a fad that was better to let pass.</p>\n<p>Of course, this does not appear to be the case. Service workers are being implemented all over the web; from sites trying to provide seamless offline experiences to mega blogs interested in bombarding you with desktop push notifications, service workers are becoming a fundamental part of web development.</p>\n<p>So what is a service worker? In it's simplest form, a service worker is a JavaScript file that has access to all requests and corresponding responses. For some reason I figured a service worker had to be a lot more complex than that. But no, service workers are just scripts that intercepts network requests.</p>\n<p>Why is this even necessary? On e of the core motivations for service workers are for providing better mobile experiences when connection is lost. In a mobile app if you loose connection the app doesn't crash and burn, instead it lets you know about the connection loss and allows you to continue using the app with what ever data it has downloaded. When connection returns, the app doesn't require a full reboot (refresh), instead it automatically reconnects and immediately performs relevant network requests.</p>\n<p>The allure of service workers is their potential to allow web apps to exhibit similar functionality. This is especially necessary internationally where phone plans may be limited and users do not want to download entire apps to their restricted phone storage. Instead they can use the web app, without missing out on the benefits of a mobile application.</p>\n<p>To start writing a service worker there are a few JavaScript prerequisites I recommend understanding:</p>\n<ol>\n<li>Event based programming</li>\n<li>Promises</li>\n</ol>\n<p>[1.] Service workers respond to events - the FetchEvent, InstallEvent, NotificationEvent, and SyncEvent to name a few. I would definitely recommend an understanding of JS event based programming and callbacks before learning to write a service worker.</p>\n<p>[2.] Writing Promises. While Promise logic is not always easy to follow, understanding the way they work is paramount to writing a service worker. Because services workers have the ability to intercept every single request the browser makes (from a given domain) it is important that they are non-blocking. Therefore, service work APIs rely heavily on Promises.</p>\n<p>All that is left to begin writing a service worker is learning the related APIs and how they fit together. This requires a bit of memorization off the bat, but luckily there is great <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API\">documentation</a> for reference. (love you MDN)</p>\n<h2>Getting Started</h2>\n<p>The service worker that we are going to write is relatively minimal. It should cache all of the requests related to a web page. This includes the HTML page and all of the assets loaded by that page.</p>\n<h3>Installing a service worker</h3>\n<p>A service worker needs to be \"installed\" before it can begin processing requests. We'll dive into the service worker \"life cycle\" a little later, but for now just know that simply having a service worker file in the working directory is not enough to begin processing requests.</p>\n<p>I created a simple website <a href=\"https://glitch.com/edit/#!/level-teller\">Glitch project</a> that you can \"remix\" (top right corner) and use to follow along. Besides being an awesome platform for sharing and experimenting with code, Glitch will also host your project online. This is important because we're attempting to load a site offline, if the browser is loading the files locally, then we can't test the offline behavior! If you know how to set up</p>\n<p>Site structure:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Home page</span>\n<span class=\"token operator\">/</span>index<span class=\"token punctuation\">.</span>html\n\n<span class=\"token comment\">// Extra page for testing</span>\n<span class=\"token operator\">/</span>page2<span class=\"token punctuation\">.</span>html\n\n<span class=\"token comment\">// Display when connection is lost</span>\n<span class=\"token operator\">/</span>offline<span class=\"token punctuation\">.</span>html\n\n<span class=\"token comment\">// Our stylesheet</span>\n<span class=\"token operator\">/</span>style<span class=\"token punctuation\">.</span>css\n\n<span class=\"token comment\">// Do the JavaScripts</span>\n<span class=\"token operator\">/</span>script<span class=\"token punctuation\">.</span>js\n\n<span class=\"token comment\">// The âœ¨service worker âœ¨</span>\n<span class=\"token operator\">/</span>sw<span class=\"token punctuation\">.</span>js</code></pre></div>\n<p>Okay, so let's get started! The service workers (<code class=\"language-text\">sw.js</code>) has some super basic code inside of it. The initial contents are:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// sw.js - this is the service worker!</span>\nself<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'install'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>installEvent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Service worker installed! ðŸŽ‰'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>So we're looking for the message 'Service worker installed! ðŸŽ‰' to be logged to the console, but it isn't. Remember how I said the service worker had to be installed before it can begin processing requests? Well, we never installed it! To do so, we're going to update <code class=\"language-text\">script.js</code> to register our service worker.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// script.js</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script.js loaded'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// first check if the serviceWorkers API is supported!</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'serviceWorker'</span> <span class=\"token keyword\">in</span> navigator<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./sw.js'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> scope<span class=\"token punctuation\">:</span> <span class=\"token string\">'/'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The above code will first check if the browser supports the service worker API and then call the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerContainer/register\">register()</a> method on <code class=\"language-text\">navigator.serviceWorker</code> which is a <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerContainer\">ServiceWorkerContainer</a> object. I'm a big believer in becoming comfortable with the documentation of whatever I'm learning, so I'll try to link to everything as I go.</p>\n<p>The <code class=\"language-text\">ServiceWorkerContainer.register()</code> method accepts two paramaters:</p>\n<ol>\n<li>The path to the service worker script (<code class=\"language-text\">sw.js</code> in our case)</li>\n<li>An object defining the scope which the service worker should be used on (<code class=\"language-text\">&#39;/&#39;</code> scopes all from our domain)</li>\n</ol>\n<p>Now when the site loads it will register our service worker if it hasn't already been registered. To verify the service worker has been installed, we can navigate to the 'Application' tab of the Chrome Developer Tools and the 'Service Workers' menu side bar item.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c3fc1bc63b65b58b6a2d062aeea775cd/a231f/sw-debug.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 660px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 77.77777777777777%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACkUlEQVQ4y6WTy05TURSGG40+hLS0Pdd97qfQQEtpIQEhgYRjAW1x5FvwFDpz5sy5OnDgZcCES2xLeAlzBs4cyqF7+a99SgXjhNjkz9pnZ+1vrX/t3cK3T28ffx186V6MLnaGw0EyHA6TwWCQjEaj5Pj4ODk6OpqK98/OzpLT01OVd35+znEHuXsnJyeiwL9ne09+9J/36eDggHq9HvX6fepj3Ufc29+n3d1d2ufY7dJTxLW1NVpZWaEkSVR+F/sct7e3Xylga3k57bQ7NDc3d+V5nrRsW3p+IH3fl7auy4qmySrEcbZSkcViUalUKk1UvCzPztLMzKMcuL6+nm5tbdHm5ua40WhIIYT0g0DGUN11ZcMRsuW5suU6som1YZrSVDKkaQlp2l5muyFpmpEDAUkXFhZofn5+HIYh2bZN6I4CrNExBZZNlq6TYBk66Yi6YahoWA4ZIsgsN6bqNXB1dTXluSCOYVslappGBg5xgSiukR+EFEQRuSikGyYZDJtAdV3LLNOgSqWSAzHgdGNjg5aWlsYRDnEiSwh0GgUAxhRiPwBUeBHppsOQvEsFNTKMAMBqDmw2mylgfCm3gGzddT3YDxTM9XyynJD48HUOC9+ZcByqVifAZb7lTofa7fbUMksBeYawnXcYoIBLeAW3gMjLajg3BaK7FFDC5SjgjcpkWRasC+IOOF7v3xRyMi6Euf+55cXFRarVauM4jvKuYJGt4vmoqGyi67/tTpRx4WmHAKX1el09G6yVVdXVDfEeiw/+Q5nj8EXpU+B3wBh4GcfxFRLuql9cFMCXCoi5/WTLk8dNXO0uYhj/AWD9tQLi4w30EXqPhA+YxV31DvpcLpdfFCa/+9DD/9QD6N7h4WHhNwF4ufTY/SNEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"View of service worker\"\n        title=\"\"\n        src=\"/static/c3fc1bc63b65b58b6a2d062aeea775cd/1dc1d/sw-debug.png\"\n        srcset=\"/static/c3fc1bc63b65b58b6a2d062aeea775cd/7d8cb/sw-debug.png 165w,\n/static/c3fc1bc63b65b58b6a2d062aeea775cd/a2a24/sw-debug.png 330w,\n/static/c3fc1bc63b65b58b6a2d062aeea775cd/1dc1d/sw-debug.png 660w,\n/static/c3fc1bc63b65b58b6a2d062aeea775cd/3a2d0/sw-debug.png 990w,\n/static/c3fc1bc63b65b58b6a2d062aeea775cd/4dfd0/sw-debug.png 1320w,\n/static/c3fc1bc63b65b58b6a2d062aeea775cd/91d3b/sw-debug.png 1980w,\n/static/c3fc1bc63b65b58b6a2d062aeea775cd/a231f/sw-debug.png 2160w\"\n        sizes=\"(max-width: 660px) 100vw, 660px\"\n      />\n  </span>\n  </a></p>\n<p>Highlighted in red are the two menus selections I made to view the state of the service worker on our site. Notice the \"Update on reload\" checkbox is also checked. This will tell the browser to fetch the service worker file on reload. Because service workers are inherently cached by the browser (in order to process offline requests), the browser will not request new versions of the service worker unless explicitly told to do so.</p>\n<p>My flow is to check the \"Update on reload\" checkbox when ever I make changes to the <code class=\"language-text\">sw.js</code> file and then un-check the box and refresh one more time. The extra request allows the updated service worker to process requests after being installed.</p>","frontmatter":{"date":"March 05, 2019","path":"/blog/taking-a-site-offline-with-service-workers","title":"Taking a Site Offline with Service Workers ðŸ¤–","image":null}}},"pageContext":{}}